@page "/character-select"
@rendermode InteractiveServer
@using WorldLeaders.Shared.Models
@using WorldLeaders.Web.Services
@inject NavigationManager Navigation
@inject ILocalStorageService LocalStorage

<PageTitle>Choose Your Character - World Leaders Game</PageTitle>

<CharacterSelection OnCharacterSelected="HandleCharacterSelected" 
                   OnBackToHome="HandleBackToHome" />

@code {
    private async Task HandleCharacterSelected(CharacterPersona selectedPersona)
    {
        try
        {
            // Store selected character persona in local storage for game use
            await LocalStorage.SetItemAsync("selectedCharacterPersona", selectedPersona);
            
            // Navigate to game - character will be loaded from storage
            Navigation.NavigateTo("/game");
        }
        catch (Exception ex)
        {
            // Fallback to query parameter if local storage fails
            Navigation.NavigateTo($"/game?character={selectedPersona.Id}");
        }
    }

    private void HandleBackToHome()
    {
        Navigation.NavigateTo("/");
    }
}