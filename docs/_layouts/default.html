<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
  <!-- Set light theme only (no toggle, no dark mode) -->
 <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  {%- seo -%}
  
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  
  {%- feed_meta -%}
  {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
  {%- endif -%}
  
  <!-- Preload critical fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  {%- include header.html -%}

  <main class="page-content" aria-label="Content">
    <div class="wrapper">
      {{ content }}
    </div>
  </main>

  {%- include footer.html -%}

  <!-- Educational Code Explainer Scripts -->
  <script src="{{ '/assets/js/educational-code-explanation-api.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/code-explainer.js' | relative_url }}"></script>

  <!-- Enhanced accessibility and mobile support -->
  <script>
    // Enhanced mobile support
    document.addEventListener('DOMContentLoaded', function() {
      // Add touch-friendly hover states for mobile
      if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
      }

      // Improve mobile scroll behavior
      let touchStartY = 0;
      document.addEventListener('touchstart', function(e) {
        touchStartY = e.touches[0].clientY;
      }, { passive: true });

      // Handle mobile menu accessibility
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', function() {
          // Close mobile menu when link is clicked
          const mobileToggle = document.querySelector('.mobile-menu-toggle');
          const navMenu = document.querySelector('.nav-menu');
          if (mobileToggle && navMenu) {
            mobileToggle.setAttribute('aria-expanded', 'false');
            navMenu.classList.remove('active');
          }
        });
      });

      // Enhanced keyboard navigation
      document.addEventListener('keydown', function(event) {
        // Skip link navigation
        if (event.key === 'Tab' && event.target.classList.contains('skip-link')) {
          event.preventDefault();
          const mainContent = document.querySelector('main');
          if (mainContent) {
            mainContent.focus();
          }
        }
      });
    });

    // Performance optimization: Lazy load images
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imageObserver.unobserve(img);
          }
        });
      });

      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }

    // Random background image selection
    // Note: These images were created using AI text-to-image generation
    // for the World Leaders Game project - educational gaming visuals
    const backgroundImages = [
      '{{ "/assets/game-ai-prompt.png" | relative_url }}',
      '{{ "/assets/game-block-ai-image.png" | relative_url }}',
      '{{ "/assets/game-block-ai-image2.jpg" | relative_url }}',
      '{{ "/assets/game-block-ai-image3.jpg" | relative_url }}'
    ];

    // Select random background on page load
    const randomImage = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
    document.body.style.setProperty('--random-bg-image', `url('${randomImage}')`);
    
    // Apply the random background to the body and page header pseudo-elements
    const style = document.createElement('style');
    style.textContent = `
      body::before {
        background-image: url('${randomImage}');
      }
      .page-header::before {
        background-image: url('${randomImage}');
      }
    `;
    document.head.appendChild(style);
  </script>

  <!-- Initialize secure proxy and educational explainer on page load -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize secure OpenAI proxy (if not already done)
      if (typeof SecureAzureProxy !== 'undefined' && !window.secureAzureProxy) {
        // The secure proxy should already be initialized from its own DOMContentLoaded
        // But ensure it's available on the window object
        setTimeout(function() {
          if (!window.secureAzureProxy && window.secureConfigHelper) {
            window.secureAzureProxy = window.secureConfigHelper.secureProxy;
          }
          console.log('üîí Secure OpenAI proxy status:', window.secureAzureProxy ? 'Available' : 'Not available');
        }, 100);
      }
      
      // Make EducationalCodeExplanationAPI available globally
      if (typeof EducationalCodeExplanationAPI !== 'undefined' && !window.EducationalCodeExplanationAPI) {
        window.EducationalCodeExplanationAPI = EducationalCodeExplanationAPI;
        console.log('üìö Educational API made available globally');
      }
      
      // Initialize code explainer only on pages with code
      if (document.querySelector('pre code, .highlight code')) {
        // Ensure the class is available before initializing
        if (typeof EducationalCodeExplainer !== 'undefined') {
          if (!window.educationalCodeExplainer) {
            window.educationalCodeExplainer = new EducationalCodeExplainer();
            console.log('üßë‚Äçüè´ Educational Code Explainer initialized for young learners!');
          }
        } else {
          console.log('‚ö†Ô∏è EducationalCodeExplainer class not available');
        }
      }
    });
  </script>
</body>
</html>